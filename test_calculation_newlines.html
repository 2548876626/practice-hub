<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>计算题换行符测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .calculation-container {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
        }
        .calculation-title {
            font-size: 22px;
            font-weight: 600;
            color: #f2c744;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #34495e;
        }
        .calculation-problem {
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 20px;
            padding: 18px;
            background: rgba(102, 126, 234, 0.08);
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        .calculation-solution {
            margin-top: 20px;
            padding: 20px;
            background: rgba(40, 167, 69, 0.08);
            border-radius: 12px;
            border: 1px solid rgba(40, 167, 69, 0.3);
        }
        .calculation-solution h4 {
            font-size: 18px;
            font-weight: 600;
            color: #28a745;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .calculation-solution h4::before {
            content: "💡";
            font-size: 20px;
        }
        .calculation-steps {
            font-size: 15px;
            line-height: 1.8;
            margin-bottom: 15px;
            padding: 18px;
            background: #34495e;
            border-radius: 10px;
            border: 1px solid #4a5f7a;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .code {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧮 计算题换行符处理测试</h1>
        <p>测试计算题中的换行符是否正确显示为换行</p>

        <!-- 测试数据展示 -->
        <div class="test-section">
            <h3>📋 测试数据</h3>
            <div class="code" id="testDataDisplay"></div>
        </div>

        <!-- 问题演示 -->
        <div class="test-section">
            <h3>❌ 问题演示：不处理换行符</h3>
            <div class="calculation-container">
                <div class="calculation-title">计算题</div>
                <div class="calculation-problem" id="problemWithoutFix">
                    <!-- 这里显示未处理的文本 -->
                </div>
                <div class="calculation-solution">
                    <h4>详细解答</h4>
                    <div class="calculation-steps" id="solutionWithoutFix">
                        <!-- 这里显示未处理的文本 -->
                    </div>
                </div>
            </div>
            <div class="error">❌ 换行符显示为文字，没有实际换行效果</div>
        </div>

        <!-- 解决方案演示 -->
        <div class="test-section">
            <h3>✅ 解决方案：正确处理换行符</h3>
            <div class="calculation-container">
                <div class="calculation-title">计算题</div>
                <div class="calculation-problem" id="problemWithFix">
                    <!-- 这里显示处理后的文本 -->
                </div>
                <div class="calculation-solution">
                    <h4>详细解答</h4>
                    <div class="calculation-steps" id="solutionWithFix">
                        <!-- 这里显示处理后的文本 -->
                    </div>
                </div>
            </div>
            <div class="success">✅ 换行符正确转换为换行，显示效果正常</div>
        </div>

        <!-- 实际数据测试 -->
        <div class="test-section">
            <h3>🚀 实际数据测试</h3>
            <div id="realDataTest">
                <!-- 这里会显示实际的计算题数据 -->
            </div>
        </div>

        <!-- 代码说明 -->
        <div class="test-section">
            <h3>💻 代码实现</h3>
            <div class="code">
                <strong>工具函数：</strong><br>
                <pre>function formatTextWithLineBreaks(text, useHTML = true) {
    if (!text || typeof text !== 'string') return '';
    
    if (useHTML) {
        return text.replace(/\\n/g, '&lt;br&gt;');
    } else {
        return text.replace(/\\n/g, '\n');
    }
}</pre>
            </div>
            <div class="code">
                <strong>使用方式：</strong><br>
                <code>element.innerHTML = formatTextWithLineBreaks(question.solution);</code>
            </div>
        </div>
    </div>

    <script>
        // 文本换行符处理工具函数
        function formatTextWithLineBreaks(text, useHTML = true) {
            if (!text || typeof text !== 'string') return '';
            
            if (useHTML) {
                return text.replace(/\\n/g, '<br>');
            } else {
                return text.replace(/\\n/g, '\n');
            }
        }

        // 测试数据
        const testData = {
            "id": 35,
            "title": "计算题",
            "problem": "有一条采用BLX-500型绝缘导线明敷的220/380V的TN-S线路，计算电流100A，当地最热月平均气温为+25ºC。\\n按发热条件选择线路的相线、N线、PE线截面。",
            "solution": "按发热条件选择导线截面：\\n相线：25平方毫米\\n中性线：16平方毫米\\nPE线：16平方毫米\\n\\n计算过程：\\n1. 查表确定载流量\\n2. 考虑温度修正系数\\n3. 选择合适截面"
        };

        // 显示测试数据
        document.getElementById('testDataDisplay').textContent = JSON.stringify(testData, null, 2);

        // 问题演示：不处理换行符
        document.getElementById('problemWithoutFix').textContent = testData.problem;
        document.getElementById('solutionWithoutFix').textContent = testData.solution;

        // 解决方案演示：正确处理换行符
        document.getElementById('problemWithFix').innerHTML = formatTextWithLineBreaks(testData.problem);
        document.getElementById('solutionWithFix').innerHTML = formatTextWithLineBreaks(testData.solution);

        // 实际数据测试
        function loadRealData() {
            const realDataContainer = document.getElementById('realDataTest');
            
            // 模拟从JSON加载的数据
            const realQuestions = [
                {
                    "id": 32,
                    "title": "简答题",
                    "problem": "互感器分为电压和电流互感器，简述它们使用中的注意事项",
                    "solution": "互感器使用注意事项：\\n1. 电流互感器二次侧不得开路，电压互感器二次侧不得短路；\\n2. 电压互感器和电流互感器二次侧有一端必须接地；\\n3. 电压互感器和电流互感器在连接时应注意其端子的极性。"
                },
                {
                    "id": 34,
                    "title": "计算题",
                    "problem": "根据题目图片内容进行计算。",
                    "solution": "根据计算结果：\\n6.3/121KV；110KV；35KV"
                }
            ];

            let html = '';
            realQuestions.forEach((question, index) => {
                html += `
                    <div class="calculation-container" style="margin: 15px 0;">
                        <div class="calculation-title">${question.title} (第${index + 1}题)</div>
                        <div class="calculation-problem">
                            ${formatTextWithLineBreaks(question.problem)}
                        </div>
                        <div class="calculation-solution">
                            <h4>详细解答</h4>
                            <div class="calculation-steps">
                                ${formatTextWithLineBreaks(question.solution)}
                            </div>
                        </div>
                    </div>
                `;
            });

            realDataContainer.innerHTML = html;
        }

        // 页面加载时执行测试
        window.addEventListener('load', function() {
            loadRealData();
            console.log('换行符处理测试页面加载完成');
        });
    </script>
</body>
</html>
